{"ast":null,"code":"import _Tooltip from \"antd/lib/tooltip\";\nimport _Dropdown from \"antd/lib/dropdown\";\nimport _Avatar from \"antd/lib/avatar\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport _Input from \"antd/lib/input\";\nimport _Menu from \"antd/lib/menu\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport _Layout from \"antd/lib/layout\";\nimport _JSXStyle from \"styled-jsx/style\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport Link from \"next/link\";\nimport { UserOutlined, GithubOutlined } from '@ant-design/icons';\nimport { useCallback, useState } from 'react'; // import { Children } from \"react\";\n\nimport Container from '../components/Container';\nimport { withRouter } from 'next/router'; // 注意这个 connect 是小写\n\nimport { connect } from 'react-redux';\nimport { logout } from '../store/store';\nimport axios from 'axios';\nimport getConfig from \"next/config\";\nconst {\n  publicRuntimeConfig\n} = getConfig();\nconst {\n  Header,\n  Content,\n  Footer\n} = _Layout;\nconst gitHubIconStyle = {\n  color: 'white',\n  fontSize: 40,\n  display: 'block',\n  marginRight: 20\n};\nconst footerStyle = {\n  textAlign: 'center'\n};\n\nconst Comp = ({\n  color,\n  children,\n  style\n}) => /*#__PURE__*/_jsx(\"div\", {\n  style: _objectSpread({\n    color\n  }, style),\n  children: children\n});\n\nconst myLayout = ({\n  children,\n  user,\n  logout,\n  router\n}) => {\n  const urlQuery = router.query && router.query.query;\n  const {\n    0: search,\n    1: setSearch\n  } = useState(urlQuery || '');\n  const handleSearchChange = useCallback(event => {\n    setSearch(event.target.value);\n  }, [setSearch]); // 注意：我们传入的是跟 search 有关的，所以要写下跟 search 的依赖\n\n  const handleOnSearch = useCallback(() => {\n    // 进行路由跳转\n    router.push(`/search?query=${search}`);\n  }, [search]);\n  const handleLogout = useCallback(() => {\n    // 这里要触发一个 action ，因为用户的状态是保存在 action 里面的\n    logout(); // this.forceUpdate();\n  }, [logout]); // 使用 withRouter 包含着组件里面，就可以拿到 router 的内容\n\n  const handleGotoOAuth = useCallback(e => {\n    e.preventDefault();\n    axios.get(`/prepare-auth?url=${router.asPath}`).then(resp => {\n      if (resp.status === 200) {\n        location.href = publicRuntimeConfig.OAUTH_URL;\n      } else {\n        console.log('prepare auth failed', resp);\n      }\n    }).catch(err => {\n      console.log('prepare auth failed', err);\n    });\n  }, []);\n\n  const userDropDown = /*#__PURE__*/_jsx(_Menu, {\n    children: /*#__PURE__*/_jsx(_Menu.Item, {\n      children: /*#__PURE__*/_jsx(\"a\", {\n        onClick: handleLogout,\n        children: \"\\u767B \\u51FA\"\n      })\n    })\n  });\n\n  return /*#__PURE__*/_jsxs(_Layout, {\n    children: [/*#__PURE__*/_jsx(Header, {\n      children: /*#__PURE__*/_jsxs(Container, {\n        renderer: /*#__PURE__*/_jsx(\"div\", {\n          className: \"jsx-2856213633\" + \" \" + \"header-inner\"\n        }),\n        children: [/*#__PURE__*/_jsxs(\"div\", {\n          className: \"jsx-2856213633\" + \" \" + \"header-left\",\n          children: [/*#__PURE__*/_jsx(\"div\", {\n            className: \"jsx-2856213633\" + \" \" + \"logo\"\n          }), /*#__PURE__*/_jsx(Link, {\n            href: \"/\",\n            children: /*#__PURE__*/_jsx(GithubOutlined, {\n              style: gitHubIconStyle\n            })\n          }), /*#__PURE__*/_jsx(_Input.Search, {\n            placeholder: \"\\u641C\\u7D22\\u4ED3\\u5E93\",\n            value: search,\n            onChange: handleSearchChange,\n            onSearch: handleOnSearch\n          })]\n        }), /*#__PURE__*/_jsx(\"div\", {\n          className: \"jsx-2856213633\" + \" \" + \"header-right\",\n          children: /*#__PURE__*/_jsx(\"div\", {\n            className: \"jsx-2856213633\" + \" \" + \"user\",\n            children: user && user.id ? /*#__PURE__*/_jsx(_Dropdown, {\n              overlay: userDropDown,\n              children: /*#__PURE__*/_jsx(\"a\", {\n                href: \"/\",\n                className: \"jsx-2856213633\",\n                children: /*#__PURE__*/_jsx(_Avatar, {\n                  size: 40,\n                  src: user.avatar_url,\n                  icon: /*#__PURE__*/_jsx(UserOutlined, {})\n                })\n              })\n            }) : /*#__PURE__*/_jsx(_Tooltip, {\n              title: \"\\u70B9\\u51FB\\u8FDB\\u884C\\u767B\\u5F55\",\n              children: /*#__PURE__*/_jsx(\"a\", {\n                href: `/prepare-auth?url=${router.asPath}`,\n                className: \"jsx-2856213633\",\n                children: /*#__PURE__*/_jsx(_Avatar, {\n                  size: 40,\n                  icon: /*#__PURE__*/_jsx(UserOutlined, {})\n                })\n              })\n            })\n          })\n        })]\n      })\n    }), /*#__PURE__*/_jsx(Content, {\n      children: /*#__PURE__*/_jsx(Container, {\n        children: children\n      })\n    }), /*#__PURE__*/_jsxs(Footer, {\n      style: footerStyle,\n      children: [\"Develop by Jokey @\", /*#__PURE__*/_jsx(\"a\", {\n        href: \"mailto:jokey@hotmail.com\",\n        className: \"jsx-2856213633\",\n        children: \"jokey@hotmail.com\"\n      })]\n    }), /*#__PURE__*/_jsx(_JSXStyle, {\n      id: \"184885381\",\n      children: [\".header-inner.jsx-2856213633{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;}\", \".header-left.jsx-2856213633{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}\", \".header-left.jsx-2856213633{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:start;-webkit-justify-content:flex-start;-ms-flex-pack:start;justify-content:flex-start;}\"]\n    }), /*#__PURE__*/_jsx(_JSXStyle, {\n      id: \"3540046733\",\n      children: [\"html{overflow-y:overlay;}\", \"#__next{height:100%;}\", \".ant-layout{min-height:100%;}\", \".ant-layout-header{padding-left:0;padding-right:0;}\", \".ant-layout-content{background:#fff;}\"]\n    })]\n  });\n};\n\nexport default connect(function mapState(state) {\n  return {\n    user: state.user\n  };\n}, function mapReducer(dispatch) {\n  return {\n    logout: () => dispatch(logout())\n  };\n})(withRouter(myLayout));","map":null,"metadata":{},"sourceType":"module"}