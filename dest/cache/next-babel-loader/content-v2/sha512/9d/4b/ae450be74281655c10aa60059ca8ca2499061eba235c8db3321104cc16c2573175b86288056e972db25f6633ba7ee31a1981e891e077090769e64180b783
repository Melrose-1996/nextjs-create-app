{"ast":null,"code":"import _Spin from \"antd/lib/spin\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport _Select from \"antd/lib/select\";\nvar _jsxFileName = \"C:\\\\Users\\\\pc\\\\Desktop\\\\\\u6155\\u8BFE\\u5B66\\u4E60\\\\nextjs-create-app\\\\components\\\\SearchUser.jsx\";\nimport { useState, useCallback, useRef } from 'react';\nimport api from '../lib/api';\nimport { debounce } from 'lodash';\nconst Option = _Select.Option;\n\nfunction SearchUser({\n  onChange,\n  value\n}) {\n  // 等同于 {current:0}\n  const lastFetchIdRef = useRef(0);\n  const {\n    0: fetching,\n    1: setFetching\n  } = useState(false);\n  const {\n    0: options,\n    1: setOptions\n  } = useState([]);\n  const fetchUser = useCallback(debounce(value => {\n    // 每次执行发起请求的时候，让该值向上加 1\n    lastFetchIdRef.current += 1; // 这个 fetchId 表示执行这次 request 的 id\n\n    const fetchId = lastFetchIdRef.current;\n    setFetching(true);\n    setOptions([]); // 不需要传入 req 和 res ，因为这是一个要用户点输入才会执行的操作，肯定是在浏览器环境执行的内容\n\n    if (!value) {\n      return;\n    }\n\n    api.request({\n      url: `/search/users?q=${value}`\n    }).then(reps => {\n      // 如果一旦这个 fetchId 和 id 不一致，所以前面的请求是可以抛弃的\n      if (fetchId !== lastFetchIdRef.current) {\n        return setFetching(false);\n      }\n\n      const data = reps.data.items.map(user => ({\n        text: user.login,\n        value: user.login\n      }));\n      console.log(data);\n      setFetching(false);\n      setOptions(data);\n    });\n  }, 500), []); // 用户在下拉框出来选了某个值之后\n  // 这个 value 就是用户选择的值，对应的就是某个 option 上的 value\n\n  const handleChange = value => {\n    // value 是某个 option 的值\n    setOptions([]);\n    setFetching(false); // 数据传递给我们使用这个组件的地方，接收一个 onChange 的参数，而这个参数是一个方法，把这个 value 传递出去，然后外面使用这个组件\n\n    onChange(value);\n  }; // showSearch -> 表示的是 select 具有搜索功能\n  // filterOption -> 用于 Select 组件现成已经有 Option 来出现了，这个时候我们输入框中输入文字，是输入我们现有的已经在 Option 里面的展示的这些内容。 因为我们要展示服务端的内容，所以设置为 false。\n\n\n  return /*#__PURE__*/_jsxDEV(_Select, {\n    style: {\n      width: 200\n    },\n    showSearch: true,\n    notFoundContent: fetching ? /*#__PURE__*/_jsxDEV(_Spin, {\n      size: \"small\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 66,\n      columnNumber: 89\n    }, this) : /*#__PURE__*/_jsxDEV(\"span\", {\n      children: \"Nothing Found\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 66,\n      columnNumber: 113\n    }, this),\n    filterOption: false,\n    placeholder: \"\\u521B\\u5EFA\\u8005\",\n    allowClear: true,\n    onSearch: fetchUser,\n    onChange: handleChange,\n    value: value,\n    children: options.map(ops => /*#__PURE__*/_jsxDEV(Option, {\n      value: ops.value,\n      children: ops.text\n    }, ops.value, false, {\n      fileName: _jsxFileName,\n      lineNumber: 68,\n      columnNumber: 32\n    }, this))\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 66,\n    columnNumber: 12\n  }, this);\n}\n\nexport default SearchUser;","map":{"version":3,"sources":["C:/Users/pc/Desktop/慕课学习/nextjs-create-app/components/SearchUser.jsx"],"names":["useState","useCallback","useRef","api","debounce","Option","SearchUser","onChange","value","lastFetchIdRef","fetching","setFetching","options","setOptions","fetchUser","current","fetchId","request","url","then","reps","data","items","map","user","text","login","console","log","handleChange","width","ops"],"mappings":"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","sourcesContent":["import { useState, useCallback, useRef } from 'react'\r\n\r\nimport { Select, Spin } from 'antd'\r\n\r\nimport api from '../lib/api'\r\n\r\nimport { debounce } from 'lodash'\r\n\r\nconst Option = Select.Option\r\n\r\nfunction SearchUser({ onChange, value }) {\r\n    // 等同于 {current:0}\r\n    const lastFetchIdRef = useRef(0)\r\n\r\n    const [fetching, setFetching] = useState(false)\r\n\r\n    const [options, setOptions] = useState([])\r\n\r\n    const fetchUser = useCallback(debounce(value => {\r\n\r\n        // 每次执行发起请求的时候，让该值向上加 1\r\n        lastFetchIdRef.current += 1\r\n        // 这个 fetchId 表示执行这次 request 的 id\r\n        const fetchId = lastFetchIdRef.current\r\n\r\n        setFetching(true)\r\n        setOptions([])\r\n        // 不需要传入 req 和 res ，因为这是一个要用户点输入才会执行的操作，肯定是在浏览器环境执行的内容\r\n\r\n        if (!value) {\r\n            return\r\n        }\r\n        api.request({\r\n            url: `/search/users?q=${value}`\r\n        }).then(reps => {\r\n            // 如果一旦这个 fetchId 和 id 不一致，所以前面的请求是可以抛弃的\r\n            if (fetchId !== lastFetchIdRef.current) {\r\n                return setFetching(false)\r\n            }\r\n            const data = reps.data.items.map(user => ({\r\n                text: user.login,\r\n                value: user.login\r\n            }))\r\n            console.log(data);\r\n            setFetching(false)\r\n            setOptions(data)\r\n        })\r\n\r\n\r\n    }, 500), [])\r\n\r\n    // 用户在下拉框出来选了某个值之后\r\n    // 这个 value 就是用户选择的值，对应的就是某个 option 上的 value\r\n    const handleChange = (value) => {\r\n        // value 是某个 option 的值\r\n        setOptions([])\r\n        setFetching(false)\r\n        // 数据传递给我们使用这个组件的地方，接收一个 onChange 的参数，而这个参数是一个方法，把这个 value 传递出去，然后外面使用这个组件\r\n        onChange(value)\r\n    }\r\n\r\n\r\n\r\n    // showSearch -> 表示的是 select 具有搜索功能\r\n    // filterOption -> 用于 Select 组件现成已经有 Option 来出现了，这个时候我们输入框中输入文字，是输入我们现有的已经在 Option 里面的展示的这些内容。 因为我们要展示服务端的内容，所以设置为 false。\r\n    return <Select style={{ width: 200 }} showSearch={true} notFoundContent={fetching ? <Spin size='small' /> : <span>Nothing Found</span>} filterOption={false} placeholder='创建者' allowClear={true} onSearch={fetchUser} onChange={handleChange} value={value}>\r\n        {\r\n            options.map(ops => <Option value={ops.value} key={ops.value}>{ops.text}</Option>)\r\n        }\r\n    </Select>\r\n\r\n}\r\n\r\nexport default SearchUser"]},"metadata":{},"sourceType":"module"}